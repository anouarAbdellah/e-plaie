"use strict";(self.webpackChunkargon_dashboard_angular=self.webpackChunkargon_dashboard_angular||[]).push([[813],{5813:(G,u,a)=>{a.r(u),a.d(u,{PtisModule:()=>D});var p=a(6895),h=a(3060),c=a(2340),e=a(4650),f=a(529);let _=(()=>{class o{constructor(t){this.http=t}all(t){return this.http.get(`${c.N.url}/api/ptis`,t)}update(t,i){return this.http.post(`${c.N.url}/api/ptis/${t}`,i)}create(t){return this.http.post(`${c.N.url}/api/ptis`,t)}status(t,i){return this.http.put(`${c.N.url}/api/ptis/status/${t}`,i)}find(t){return this.http.get(`${c.N.url}/api/ptis/${t}`)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(f.eN))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var b=a(4327),m=a(136),v=a(4463),T=a(3986),F=a(9359),P=a(1424),E=a(2953),C=a(7009),k=a(1481),x=a(4424),d=a(4006),Z=a(1683);const y=["f"];function L(o,l){1&o&&(e.TgZ(0,"div",38),e._uU(1," Code est requis. "),e.qZA())}function M(o,l){1&o&&(e.TgZ(0,"div",38),e._uU(1," Nom est requis. "),e.qZA())}function A(o,l){if(1&o&&(e.TgZ(0,"option",39),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t)}}function J(o,l){1&o&&(e.TgZ(0,"div",38),e._uU(1," Etiologie est requis. "),e.qZA())}function N(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",40)(1,"button",41),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.onRemoveFile(s.id,"image"))}),e._UZ(2,"i",42),e.qZA(),e._UZ(3,"img",43),e.qZA()}if(2&o){const t=l.$implicit,i=e.oxw();e.xp6(3),e.Q6J("src",i.assetLink(t.path),e.LSH)}}function S(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",44)(1,"button",41),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.onRemoveFile(s.id,"video"))}),e._UZ(2,"i",42),e.qZA(),e._UZ(3,"video",45),e.qZA()}if(2&o){const t=l.$implicit,i=e.oxw();e.xp6(3),e.Q6J("src",i.assetLink(t.path),e.LSH)}}function O(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",46)(1,"input",47),e.NdJ("change",function(n){const r=e.CHM(t).index,g=e.oxw();return e.KtG(g.onChangeLink(n,r))}),e.qZA(),e.TgZ(2,"button",48),e.NdJ("click",function(){const s=e.CHM(t).index,r=e.oxw();return e.KtG(r.onRemoveLink(s))}),e._UZ(3,"i",42),e.qZA()()}if(2&o){const t=l.$implicit,i=l.index;e.xp6(1),e.MGl("name","link-item-",i,""),e.Q6J("value",t)}}function q(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",49)(1,"button",41),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw();return e.KtG(r.onRemoveFile(s.id,"link"))}),e._UZ(2,"i",42),e.qZA(),e._UZ(3,"div",50),e.qZA()}if(2&o){const t=l.$implicit,i=e.oxw();e.xp6(3),e.Q6J("innerHTML",i.getCleanLink(t.path),e.oJD)}}function I(o,l){1&o&&(e.TgZ(0,"div",38),e._uU(1," Description est requis. "),e.qZA())}let Q=(()=>{class o{constructor(t,i,n,s){this.ptisService=t,this.modalService=i,this._snackBar=n,this.sanitizer=s,this.title=m._G.PTIS,this.isLoading=!1,this.horizontalPosition="end",this.verticalPosition="bottom",this.etiologies=m.u3,this.defaultImages=[],this.defaultVideos=[],this.defaultLinks=[],this.closingEvent=new e.vpe,this.reloadEvent=new e.vpe}ngOnInit(){if(this.title=(this.selectedElement?m._G.UPDATE_ELEMENT:m._G.CREATE_ELEMENT)+" "+this.title,this.data={etiology:this.selectedElement?this.selectedElement.etiology:"",code:this.selectedElement?this.selectedElement.code:"",name:this.selectedElement?this.selectedElement.name:"",description:this.selectedElement?this.selectedElement.description:"",images:[],videos:[],links:[],files_to_remove:[],enabled:!this.selectedElement||this.selectedElement.enabled},this.selectedElement){let t=this.selectedElement.files.filter(s=>"image"===s.type),i=this.selectedElement.files.filter(s=>"video"===s.type),n=this.selectedElement.files.filter(s=>"link"===s.type);this.defaultImages=[...t],this.defaultVideos=[...i],this.defaultLinks=[...n]}}onClose(){this.closingEvent.emit()}toggleStatus(){this.data.enabled=!this.data.enabled}onChangeFiles(t,i){this.data[i]=t.target.files}onAddLink(){this.data.links.push("")}onRemoveLink(t){this.data.links.splice(t,1)}onRemoveFile(t,i){"image"===i?this.defaultImages=this.defaultImages.filter(n=>n.id!==t):"video"===i?this.defaultVideos=this.defaultVideos.filter(n=>n.id!==t):"link"===i&&(this.defaultLinks=this.defaultLinks.filter(n=>n.id!==t)),this.data.files_to_remove.push(t)}onChangeLink(t,i){this.data.links[i]=t.target.value}assetLink(t){return c.N.url+"/storage/"+t}getCleanLink(t){return this.sanitizer.bypassSecurityTrustHtml(t)}onSubmit(){const t=Object.values(this.form.controls);for(let n of t)if(n.invalid)return;this.isLoading=!0;let i=new FormData;for(let n in this.data)if("images"==n||"videos"==n||"links"==n||"files_to_remove"==n){if(this.selectedElement||"files_to_remove"!=n)for(let s of this.data[n])i.append(n+"[]",s)}else this.data[n]&&i.append(n,this.data[n]);console.log(this.data),this.selectedElement?this.ptisService.update(this.selectedElement.id,i).subscribe(n=>{this.onSuccess(n)},n=>{this.onError(n)}):this.ptisService.create(i).subscribe(n=>{this.onSuccess(n)},n=>{console.log(n),this.onError(n)})}onSuccess(t){console.log(t),this.isLoading=!1,this.reloadEvent.emit(),this.modalService.dismissAll(),this._snackBar.open("Enregistr\xe9 avec succ\xe8s!","Ok",{horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition,panelClass:["success-snackbar"]})}onError(t){console.log(t),this.isLoading=!1;let i=t.error.data;for(let n in i)this._snackBar.open(i[n],"Ok",{horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition,panelClass:["danger-snackbar"]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_),e.Y36(E.FF),e.Y36(C.ux),e.Y36(k.H7))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-ptis-form"]],viewQuery:function(t,i){if(1&t&&e.Gf(y,5),2&t){let n;e.iGM(n=e.CRH())&&(i.form=n.first)}},inputs:{selectedElement:"selectedElement"},outputs:{closingEvent:"closingEvent",reloadEvent:"reloadEvent"},decls:56,vars:16,consts:[[3,"title","isLoading","closingEvent","submit"],["f","ngForm"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["type","text","name","code","required","","placeholder","Code",1,"form-control","form-control-alternative",3,"ngModel","ngModelChange"],["code","ngModel"],["class","error-message",4,"ngIf"],["type","text","name","name","required","","placeholder","Nom",1,"form-control","form-control-alternative",3,"ngModel","ngModelChange"],["name","ngModel"],["name","etiology","required","","placeholder","Type",1,"form-control","form-control-alternative",3,"ngModel","ngModelChange"],["etiology","ngModel"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-6","d-flex","align-items-center"],[1,"form-group","d-flex","mb-0"],[1,"mr-2"],[1,"custom-toggle","mb-0"],["type","checkbox",3,"checked","click"],[1,"custom-toggle-slider","rounded-circle"],["for","images"],["type","file","id","images","name","images","multiple","","placeholder","Images",1,"form-control","form-control-alternative",3,"change"],[1,"default-images"],["class","default-image-item",4,"ngFor","ngForOf"],["for","videos"],["type","file","id","videos","name","videos","multiple","","placeholder","Videos",1,"form-control","form-control-alternative",3,"change"],[1,"default-videos"],["class","default-video-item",4,"ngFor","ngForOf"],[1,"col-md-12"],[1,"text-right"],[1,"btn","btn-danger",3,"click"],[1,"fab","fa-youtube"],[1,"links-holder"],["class","link-item",4,"ngFor","ngForOf"],[1,"default-links"],["class","default-link-item",4,"ngFor","ngForOf"],["required","","name","description","placeholder","Description",3,"ngModel","ngModelChange"],["description","ngModel"],[1,"error-message"],[3,"value"],[1,"default-image-item"],[1,"remove-item",3,"click"],[1,"fas","fa-times"],[3,"src"],[1,"default-video-item"],["controls","",3,"src"],[1,"link-item"],["type","text",1,"form-control",3,"name","value","change"],[1,"link-remove",3,"click"],[1,"default-link-item"],[1,"youtube-holder",3,"innerHTML"]],template:function(t,i){if(1&t&&(e.TgZ(0,"app-base-modal",0),e.NdJ("closingEvent",function(){return i.onClose()})("submit",function(){return i.onSubmit()}),e.TgZ(1,"form",null,1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"input",5,6),e.NdJ("ngModelChange",function(s){return i.data.code=s}),e.qZA(),e.YNc(8,L,2,0,"div",7),e.qZA()(),e.TgZ(9,"div",3)(10,"div",4)(11,"input",8,9),e.NdJ("ngModelChange",function(s){return i.data.name=s}),e.qZA(),e.YNc(13,M,2,0,"div",7),e.qZA()(),e.TgZ(14,"div",3)(15,"div",4)(16,"select",10,11),e.NdJ("ngModelChange",function(s){return i.data.etiology=s}),e.TgZ(18,"option",12),e._uU(19,"Type"),e.qZA(),e.YNc(20,A,2,2,"option",13),e.qZA(),e.YNc(21,J,2,0,"div",7),e.qZA()(),e.TgZ(22,"div",14)(23,"div",15)(24,"span",16),e._uU(25,"Enabled:"),e.qZA(),e.TgZ(26,"label",17)(27,"input",18),e.NdJ("click",function(){return i.toggleStatus()}),e.qZA(),e._UZ(28,"span",19),e.qZA()()(),e.TgZ(29,"div",3)(30,"div",4)(31,"label",20),e._uU(32,"Images"),e.qZA(),e.TgZ(33,"input",21),e.NdJ("change",function(s){return i.onChangeFiles(s,"images")}),e.qZA()(),e.TgZ(34,"div",22),e.YNc(35,N,4,1,"div",23),e.qZA()(),e.TgZ(36,"div",3)(37,"div",4)(38,"label",24),e._uU(39,"Videos"),e.qZA(),e.TgZ(40,"input",25),e.NdJ("change",function(s){return i.onChangeFiles(s,"videos")}),e.qZA()(),e.TgZ(41,"div",26),e.YNc(42,S,4,1,"div",27),e.qZA()(),e.TgZ(43,"div",28)(44,"div",29)(45,"button",30),e.NdJ("click",function(){return i.onAddLink()}),e._UZ(46,"i",31),e._uU(47," Ajouter lien YouTube"),e.qZA()(),e.TgZ(48,"div",32),e.YNc(49,O,4,2,"div",33),e.qZA(),e.TgZ(50,"div",34),e.YNc(51,q,4,1,"div",35),e.qZA()(),e.TgZ(52,"div",28)(53,"ckeditor",36,37),e.NdJ("ngModelChange",function(s){return i.data.description=s}),e.qZA(),e.YNc(55,I,2,0,"div",7),e.qZA()()()()),2&t){const n=e.MAs(7),s=e.MAs(12),r=e.MAs(17),g=e.MAs(54);e.Q6J("title",i.title)("isLoading",i.isLoading),e.xp6(6),e.Q6J("ngModel",i.data.code),e.xp6(2),e.Q6J("ngIf",n.invalid&&n.touched),e.xp6(3),e.Q6J("ngModel",i.data.name),e.xp6(2),e.Q6J("ngIf",s.invalid&&s.touched),e.xp6(3),e.Q6J("ngModel",i.data.etiology),e.xp6(4),e.Q6J("ngForOf",i.etiologies),e.xp6(1),e.Q6J("ngIf",r.invalid&&r.touched),e.xp6(6),e.Q6J("checked",i.data.enabled),e.xp6(8),e.Q6J("ngForOf",i.defaultImages),e.xp6(7),e.Q6J("ngForOf",i.defaultVideos),e.xp6(7),e.Q6J("ngForOf",i.data.links),e.xp6(2),e.Q6J("ngForOf",i.defaultLinks),e.xp6(2),e.Q6J("ngModel",i.data.description),e.xp6(2),e.Q6J("ngIf",g.invalid&&g.touched)}},dependencies:[p.sg,p.O5,x.u,d._Y,d.YN,d.Kr,d.Fj,d.EJ,d.JJ,d.JL,d.Q7,d.On,d.F,Z.u],styles:[".links-holder[_ngcontent-%COMP%]{padding:10px}.link-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:10px}.link-remove[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;font-size:17px;border:1px solid #484848;color:#484848;margin-left:24px;cursor:pointer}.default-images[_ngcontent-%COMP%], .default-videos[_ngcontent-%COMP%], .default-links[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:start;flex-wrap:wrap}.default-image-item[_ngcontent-%COMP%], .default-video-item[_ngcontent-%COMP%], .default-link-item[_ngcontent-%COMP%]{margin:10px;position:relative;width:180px;height:180px;border:1px solid;display:flex;align-items:center;justify-content:center}button.remove-item[_ngcontent-%COMP%]{position:absolute;right:-10px;top:-10px;border-radius:50%;width:27px;height:27px;font-size:14px;text-align:center;padding:0;cursor:pointer}.default-image-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], .default-video-item[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{max-width:100%;max-height:100%}"]}),o})();function U(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"app-ptis-form",16),e.NdJ("closingEvent",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onClose())})("reloadEvent",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.onFormReload())}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("id",t.selectedElement)("selectedElement",t.selectedElement)}}const w=[{path:"",component:(()=>{class o{constructor(t,i){this.ptisService=t,this.translate=i,this.data=[],this.isShowForm=!1,this.selectedElement=null,this.page=1,this.pagesCount=1,this.isLoading=!0,this.tableData=[{header:"Id",key:"id",type:"text"},{header:"Nom",key:"name",type:"text"},{header:"Code",key:"code",type:"text"},{header:"Etiologie",key:"etiology",type:"text"},{header:"Date de cr\xe9ation",key:"created_at",type:"date"},{header:"Date de modification",key:"updated_at",type:"date"},{header:"Status",key:"enabled",type:"status"}],this.filters={etiology:"",code:"",name:"",id:""},this.filtersElements=[{type:"number",name:"id",title:"ID",value:""},{type:"text",name:"code",title:"Code",value:""},{type:"text",name:"name",title:"Nom",value:""},{type:"select",name:"etiology",title:"Etiologie",value:"",elements:m.u3},{type:"status",name:"enabled",title:"Activ\xe9",value:""}]}ngOnInit(){this.onLoad()}onAdd(){this.isShowForm=!0}onClose(){this.isShowForm=!1,this.selectedElement=!1}onFormReload(){this.onClose(),this.onLoad()}toggleStatusChange(t){console.log(t.status,t.id),this.isLoading=!0,this.ptisService.status(t.id,{enabled:t.status}).subscribe(i=>{let n=this.data.findIndex(s=>s.id===t.id);n>=0&&(this.data[n].enabled=i.data.enabled),this.isLoading=!1})}onEdit(t){this.isShowForm=!0,this.selectedElement=t}onPageChange(t){console.log(t),this.page=t,this.onLoad()}onLoad(){this.isLoading=!0;let t=this.getFilters();console.log(t),this.ptisService.all({params:t}).subscribe(i=>{console.log(i),this.data=i.data.data,this.pagesCount=i.data.last_page,this.isLoading=!1},i=>{this.isLoading=!1})}exportData(){this.isLoading=!0;let t=this.getFilters(!0);this.ptisService.all({params:t,responseType:"blob"}).subscribe(i=>{console.log(i);const n=new Blob([i],{type:"text/csv"});(0,b.saveAs)(n,"pti.csv"),this.isLoading=!1},i=>{console.log(i),this.isLoading=!1})}getFilters(t=!1){let i={};for(let n in this.filters)this.filters[n]&&""!=this.filters[n]&&(i[n]=this.filters[n]);return i.page=this.page,i.limit=15,t&&(i.export=!0),i}onFiltersChange(t){this.filters={...t},this.onLoad()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_),e.Y36(v.sK))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-ptis-list"]],decls:19,vars:7,consts:[[1,"header","bg-gradient-info","pb-8","pt-5","pt-md-8"],[1,"container-fluid"],[1,"header-body"],[1,"container-fluid","mt--7"],[1,"row"],[1,"col"],[1,"card","shadow"],[1,"card-header","border-0","d-flex"],[1,"mb-0"],[1,"ml-auto"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success","ml-2",3,"click"],[3,"filters","onFilterChange"],[3,"tableData","data","isLoading","onEdit","onToggleStatus"],[3,"page","pagesCount","onPageChange"],[3,"id","selectedElement","closingEvent","reloadEvent",4,"ngIf"],[3,"id","selectedElement","closingEvent","reloadEvent"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"div",2),e.qZA()(),e.TgZ(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"h3",8),e._uU(9,"PTI"),e.qZA(),e.TgZ(10,"div",9)(11,"button",10),e.NdJ("click",function(){return i.onAdd()}),e._uU(12," Ajouter "),e.qZA(),e.TgZ(13,"button",11),e.NdJ("click",function(){return i.exportData()}),e._uU(14," Export "),e.qZA()()(),e.TgZ(15,"app-base-filter",12),e.NdJ("onFilterChange",function(s){return i.onFiltersChange(s)}),e.qZA(),e.TgZ(16,"app-base-table",13),e.NdJ("onEdit",function(s){return i.onEdit(s)})("onToggleStatus",function(s){return i.toggleStatusChange(s)}),e.qZA(),e.TgZ(17,"app-pagination-links",14),e.NdJ("onPageChange",function(s){return i.onPageChange(s)}),e.qZA()()()()(),e.YNc(18,U,1,2,"app-ptis-form",15)),2&t&&(e.xp6(15),e.Q6J("filters",i.filtersElements),e.xp6(1),e.Q6J("tableData",i.tableData)("data",i.data)("isLoading",i.isLoading),e.xp6(1),e.Q6J("page",i.page)("pagesCount",i.pagesCount),e.xp6(1),e.Q6J("ngIf",i.isShowForm))},dependencies:[p.O5,T.N,F.K,P.C,Q]}),o})()}];let Y=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[h.Bz.forChild(w),h.Bz]}),o})();var $=a(5642);let D=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[p.ez,Y,$.K,f.JF,d.u5,v.aw,C.ZX,Z.d]}),o})()}}]);